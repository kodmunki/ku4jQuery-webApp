(function(a){$.ku4webApp.config.collections={card:{name:"card"}};$.ku4webApp.config.forms={card:[{selector:"#name",type:"field",required:true},{selector:"#photo",type:"imageFileField",maxDims:[100,100]},{selector:"#description",type:"field",required:true},{selector:"#value",type:"field",required:true}]};$.ku4webApp.config.navigator={"employee.list":{model:"employee",method:"list"},"employee.add":{model:"employee",method:"add"},"department.list":{model:"department",method:"list"},"department.add":{model:"department",method:"add"}};$.ku4webApp.config.services={"card.list":{verb:"GET",uri:"./_serverStub/cardList.json",contentType:"text/json",success:"svc+cardsListed",error:"svc-cardsListed"},"card.add":{verb:"POST",uri:"./_serverStub/cardAdd.json",contentType:"text/json",success:"svc+cardAdded",error:"svc-cardAdded"}};$.ku4webApp.config.sockets={};$.ku4webApp.config.templates.forms={card:'<form class="card-form js-card-form" action=""><legend>Card Info</legend><fieldset></fieldset>{{controls}}</form>'};$.ku4webApp.config.templates.views={cardList:'<div class="card-list js-card-list"></div><button class="card-add-control js-card-add-control" onclick="cardController.create();">Add Card</button>',card:'<div class="card js-card"><img src="{{photo}}" class="card-photo"/><span class="card-name">{{name}}</span><span class="card-value">{{value}}</span><span class="card-description">{{description}}</span><button class="card-edit-control" onclick="cardController.edit(\'{{id}}\');">Edit</button></div>'};$.ku4webApp.config.validators={card:[{name:"name",spec:$.spec(function(b){return/^\w{1,140}$/.test(b)}),message:"Username is invalid."},{name:"description",spec:$.spec(function(b){return/.{1,140}/.test(b)}),message:"Invalid description."},{name:"value",spec:$.spec(function(b){return $.money.canParse(b)}),message:"Invalid value."}]};$.ku4webApp.controller("card",{list:function(){this.$model("card").listCards();return this},create:function(){this.$model("card").createCard();return this},add:function(){this.$model("card").addCard(this.$form("card").read());return this},edit:function(b){this.$model("card").editCard(b);return this}});$.ku4webApp.model("card",{listCards:function(){if(this.$state().is("cardsListed")){this.$notify("onCardsListed",this.$collection("card").find())}else{this.$service("card.list").call()}return this},createCard:function(){this.$notify("onCreateCard");return this},addCard:function(b){b.add("id",$.uid()).update("photo",$.image.dataUrlFromFile(b.find("photo")));this.$collection("card").insert(b.toObject());return this},editCard:function(c){console.log(c);var b=this.$collection("card").find({id:c});if(!($.isArray(b)&&b.length==1)){this.$notify("onError",new Error("Card collection corrupted."))}else{this.$notify("onEditCard",b[0])}return this},updateCard:function(c){var b=c.toObject();this.$collection("card").update({id:b.id},b);this.$notify("onCardUpdated",b);return this},onCardsListed:function(c){var b=$.dto.parseJson(c).toObject();this.$collection("card").init(b);this.$state().set("cardsListed");this.$notify("onCardsListed",b)},onCardAdded:function(c){var b=$.dto.parseJson(c).toObject();this.$collection("card").insert(b)},onCardsListedError:function(b){this.$notify("onCardListedError, onError",new Error("Card listing exception."))}},{"svc+cardsListed":"onCardsListed","svc-cardsListed":"onCardsListedError"});$.ku4webApp.template("card",{renderCardForm:function(){return this.$render(this.$forms("card"))},renderCardList:function(b){return this.$renderList(this.$views("card"),b,"",function(c){c.value=$.money.parse(c.value).toString();return c})}});$.ku4webApp.view("card",{displayCardList:function(c){$(".js-card-form").remove();var b=this.$template("card").renderCardList(c);$("#site").append(b)},displayCardAdded:function(b){console.log(b)},displayEditCard:function(c){$(".js-card").remove();var b=this.$template("card").renderCardForm();$("#site").append(b)},displayCardListError:function(b){console.log(b)},displayError:function(b){console.log(b)}},{onCardsListed:"displayCardList",onCardAdded:"displayCardAdded",onEditCard:"displayEditCard",onCardsListedError:"displayCardListError",onError:"displayError"})})();