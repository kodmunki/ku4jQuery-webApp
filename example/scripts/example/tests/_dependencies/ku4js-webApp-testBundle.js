(function(c){$.ku4webApp_testBundle={};$.ku4webAppUT={};function b(){var i=$.ku4webApp_testBundle.app();this._mediator=i.mediator;this._app=i}b.prototype={mediator:function(){return this._mediator},logErrors:function(){this._mediator.logErrors();return this},throwErrors:function(){this._mediator.throwErrors();return this},callback:function(i){$.ku4webApp_testBundle.callback=i;return this},onModelCall:function(i){$.ku4webApp_testBundle.onModelCall=i;return this},model:function(i){var j=this._app.prodModel();return $.ku4webApp.models[i](this._mediator,j.serviceFactory,j.storeFactory,j.validatorFactory)},view:function(i){return $.ku4webApp.views[i](this._app.prodModel())},controller:function(i){return $.ku4webApp.controllers[i](this._app.stubModel())},template:function(i){return this._app.prodModel().templateFactory.create(i)}};$.ku4webAppUT.bundle=function(){return new b()};function g(){var i=$.ku4webApp;this.mediator=$.mediator();this.serviceFactory=$.ku4webApp_testBundle.serviceFactory(this.mediator,i.config.services);this.storeFactory=i.storeFactory(this.mediator,i.config.collections);this.validatorFactory=i.validatorFactory(i.config.validators);this.templateFactory=i.templateFactory(i.config.templates);this.formFactory=i.formFactory(i.config.forms);this.prodModel();this.navigator=i.navigator(this.modelFactory,i.config.navigator)}g.prototype={logErrors:function(){this.mediator.logErrors();return this},throwErrors:function(){this.mediator.throwErrors();return this},stubModel:function(){this.modelFactory=$.ku4webApp_testBundle.stubModelFactory(this.mediator,this.serviceFactory,this.storeFactory,this.validatorFactory);return this},prodModel:function(){this.modelFactory=$.ku4webApp_testBundle.testModelFactory(this.mediator,this.serviceFactory,this.storeFactory,this.validatorFactory);return this}};$.ku4webApp_testBundle.app=function(){return new g()};function h(k,i,m){var l=$.str.format("$.ku4webApp.{0}",k),j=$.str.format("Requires a valid {0}. {0}= {1}",i,m);if(!$.exists(m)){throw $.ku4exception(l,j)}else{return m}}$.ku4webApp_testBundle.onModelCall=function(){return};$.ku4webApp_testBundle.model=function(j,i,r,k,p){var q=$.ku4webApp.models[j](i,r,k,p),o={};function m(){$.ku4webApp_testBundle.onModelCall.apply(this,arguments);$.ku4webApp_testBundle.onModelCall=function(){return}}for(var l in q){o[l]=m}return o};function a(j,i){this._mediator=j;this._config=i}a.prototype={call:function(l){var j=this._config,m=$.ku4webApp_testBundle.callback||function(n){return n},i=m(l),k=/^__error__$/i.test(i);if(!$.exists(j)){throw $.ku4exception("$.service","Test Bundle services require a valid config containing a 'success':[data] and an 'error':[data] configuration.")}if($.exists(j.error)&&k){this._mediator.notify(i,j.error)}else{if($.exists(j.success)){this._mediator.notify(i,j.success)}}$.ku4webApp_testBundle.callback=function(n){return n};return this}};$.ku4webApp_testBundle.service=function(j,i){return new a(j,i)};function d(k,i,l,j){this._mediator=k;this._serviceFactory=i;this._storeFactory=l;this._validatorFactory=j}d.prototype={create:function(i){return $.ku4webApp.models[i](this._mediator,this._serviceFactory,this._storeFactory,this._validatorFactory)}};$.ku4webApp_testBundle.testModelFactory=function(k,i,l,j){return new d(k,i,l,j)};function f(j,i){this._mediator=j;this._config=i}f.prototype={create:function(i){return $.ku4webApp_testBundle.service(this._mediator,this._config[i])}};$.ku4webApp_testBundle.serviceFactory=function(j,i){return new f(j,i)};function e(k,i,l,j){this._mediator=k;this._serviceFactory=i;this._storeFactory=l;this._validatorFactory=j}e.prototype={create:function(i){return $.ku4webApp_testBundle.model(i,this._mediator,this._serviceFactory,this._storeFactory,this._validatorFactory)}};$.ku4webApp_testBundle.stubModelFactory=function(k,i,l,j){return new e(k,i,l,j)}})();