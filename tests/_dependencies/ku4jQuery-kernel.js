(function(O){$=O;$.isArray=function(l){return l instanceof Array};$.isBool=function(l){return(/boolean/i.test(typeof(l)))};$.isDate=function(l){return l instanceof Date};$.isEvent=function(l){try{return l instanceof Event}catch(Y){return l===window.event}};$.isNumber=function(l){return((/number/i.test(typeof(l)))||l instanceof Number)&&!isNaN(l)};$.isObject=function(l){return $.exists(l)&&(/object/i.test(typeof(l)))&&!($.isBool(l)||$.isNumber(l)||$.isDate(l)||$.isArray(l)||$.isString(l)||$.isFunction(l))};$.isFunction=function(l){return(l instanceof Function)};$.isString=function(l){return(/string/i.test(typeof(l)))||l instanceof String};$.isZero=function(l){return l===0};$.isEven=function(l){return($.isNullOrEmpty(l)||$.isDate(l))?false:(isNaN(l)?false:($.isZero(l)?false:l%2===0))};$.isOdd=function(l){return($.isNullOrEmpty(l)||$.isDate(l))?false:(isNaN(l)?false:($.isZero(l)?false:!$.isEven(l)))};$.isNull=function(l){return l===null};$.isUndefined=function(l){return(/undefined/i.test(typeof(l)))};$.isEmpty=function(l){return $.isString(l)&&$.isZero(l.split(/\B/).length)};$.isNullOrEmpty=function(l){return !$.exists(l)||$.isEmpty(l)};$.exists=function(l){return(l!==null)&&(!$.isUndefined(l))};$.areEqual=function(Y,l){if(this.exists(Y)&&this.exists(l)){if(this.exists(Y.equals)&&value.equals(l)){return true}if(this.exists(Y.getTime)&&this.exists(l.getTime)&&Y.getTime()==l.getTime()){return true}if(Y===l){return true}else{return Y===l}}else{return Y===l}};$.xor=function(Y,l){return !Y!=!l};function q(Y,Z,l,ab){var aa="ku4EXCEPTION @ {0}: {1}\n\nBrowser Stack Trace:\n{2}\n\nku4Trace:\n{3}";return new Error($.str.format(aa,Y.toUpperCase(),Z,l,ab))}$.ku4exception=function(Z,aa){var Y=arguments.callee.caller,ab="",l="";(function(){try{generate.exeception}catch(ae){l=($.exists(ae.stack))?ae.stack.replace(/generate is.+/,""):"[Unavailable]";var ad=0,af,ac;while(Y&&(ad<10)){af=Y.toString().replace(/[\n\t\r\s]+/g," ").substring(0,100);ac=af.replace(/\W/g,"a").replace(/\s/g,"").replace(/.*base\.js:216/,"").split(/\B/).length>99?af+"...":af;ab+=$.str.format("<ku4Idx[{0}]>:{1}\n",ad,ac);Y=Y.caller;ad++}}})();return q(Z,aa,l,ab)};$.ku4Log=function(){try{console.log.apply(console,arguments)}catch(l){alert(Array.prototype.slice.call(arguments).join("\n"))}};$.replicate=function(Z){var l=($.isDate(Z))?new Date(Z):($.isArray(Z))?[]:($.isObject(Z))?{}:Z,Y;for(n in Z){Y=Z[n];l[n]=(($.isArray(Y))||($.isObject(Y)))?$.replicate(Y):Y}return l};if(!$.exists($.obj)){$.obj={}}$.obj.keys=function(Y){var l=[];for(n in Y){l[l.length]=n}return l};$.obj.values=function(Y){var l=[];for(n in Y){l[l.length]=Y[n]}return l};$.obj.count=function(l){var Y=0;for(n in l){Y++}return Y};$.obj.hasProp=function(l,Y){return($.exists(l.hasOwnProperty))?l.hasOwnProperty(Y):false};$.obj.merge=function(Y,l){var Z=$.replicate(l);for(n in Y){Z[n]=Y[n]}return Z};$.obj.meld=function(Z,Y){var l=$.replicate(Y);for(n in Z){if($.exists(l[n])){continue}l[n]=Z[n]}return l};$.obj.filter=function(){var l=Array.prototype.slice.call(arguments),aa={},ab=l[0],Z=l.slice(1);for(var ac in Z){var Y=Z[ac];aa[Y]=ab[Y]}return aa};$.Class=function(){};$.Class.prototype={get:function(l){return this["_"+l]},set:function(Y,l){this["_"+Y]=l;return this},property:function(Y,l){return($.isUndefined(l))?this.get(Y):this.set(Y,l)},isTypeOf:function(l){return this instanceof l}};$.Class.extend=function(Y,l){if(!Y||!l){return null}var Z=function(){};Z.prototype=l.prototype;Y.base=l;Y.prototype=$.obj.merge(Y.prototype,new Z());Y.prototype.constructor=Y;return Y};function d(l){d.base.call(this);this._isLocked=l||false}d.prototype={isLocked:function(){return this.get("isLocked")},lock:function(){this._isLocked=true;return this},unlock:function(){this._isLocked=false;return this}};$.Class.extend(d,$.Class);$.lock=function(l){return new d(l)};if(!$.exists($.math)){$.math={}}$.math.round=function(aa,Z){var Y=Z||0,l=Math.pow(10,-Y);return Math.round(parseFloat((aa*l).toFixed(Math.abs(Y))))/l};$.math.roundUp=function(aa,Z){var Y=Z||0,l=5*(Math.pow(10,Y-1));return $.math.round(aa+l,Z)};$.math.roundDown=function(aa,Z){if(aa===0){return 0}var Y=Z||0,l=5*(Math.pow(10,Y-1));return $.math.round(aa-l,Z)};$.math.factorial=function(Z){var l=Z,Y=Z;while(Y--){if(!!Y){l*=Y}}return l};$.math.divide=function(Y,l){var Z=$.isNumber(Y)&&$.isNumber(l)&&!$.isZero(l);if(!Z){throw $.ku4exception("$.math",$.str.format("Invalid division. value: {0}/{1} | type: {2}/{3}",Y,l,typeof Y,typeof l))}return Y/l};if(!$.exists($.str)){$.str={}}var S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";$.str.build=function(){return"".concat.apply(new String(),arguments)};$.str.format=function(){var aa=arguments,ac=aa[0],Z=aa.length,Y,ab;for(i=1;i<Z;i++){Y=aa[i];ab=($.isNull(Y))?"null":($.isUndefined(Y))?"undefined":Y.toString();ac=ac.replace(RegExp("\\{"+(i-1)+"\\}","g"),ab)}return ac};$.str.render=function(Y,aa,Z){var l=""+Y;for(var ab in aa){l=l.replace(RegExp("\\{{"+ab+"\\}}","g"),aa[ab])}return $.exists(Z)?l.replace(/\{\{.*\}\}/g,Z):l};$.str.parse=function(){return String.fromCharCode.apply(String,arguments)};$.str.trim=function(l){return $.str.trimStart($.str.trimEnd(l))};$.str.trimStart=function(l){if(!$.isString(l)){throw new Error("Cannot trim non-string values")}return($.exists(l.replace))?l.replace(/^\s*\b/,""):l};$.str.trimEnd=function(l){if(!$.isString(l)){throw new Error("Cannot trim non-string values")}return($.exists(l.replace))?l.replace(/\b\s*$/,""):l};$.str.encodeBase64=function(aa){var ab="",Z=0,ai=$.str.encodeUtf8(aa),aj,ag,ae,ah,af,ad,ac,l=function(ak){return ai.charCodeAt(ak)},Y=function(ak){return S.charAt(ak)};while(Z<ai.length){aj=l(Z++);ag=l(Z++);ae=l(Z++);ah=aj>>2;af=((aj&3)<<4)|(ag>>4);ad=((ag&15)<<2)|(ae>>6);ac=ae&63;if(isNaN(ag)){ad=ac=64}else{if(isNaN(ae)){ac=64}}ab+=(Y(ah)+Y(af)+Y(ad)+Y(ac))}return ab};$.str.decodeBase64=function(aa){var ab="",Z=0,ai=aa.replace(/[^A-Za-z0-9\+\/\=]/g,""),aj,ag,ae,ah,af,ad,ac,Y=function(ak){return S.indexOf(ai.charAt(ak))},l=function(ak){return String.fromCharCode(ak)};while(Z<ai.length){ah=Y(Z++);af=Y(Z++);ad=Y(Z++);ac=Y(Z++);aj=(ah<<2)|(af>>4);ag=((af&15)<<4)|(ad>>2);ae=((ad&3)<<6)|ac;ab+=l(aj);if(ad!=64){ab+=l(ag)}if(ac!=64){ab+=l(ae)}}return $.str.decodeUtf8(ab)};$.str.encodeUtf8=function(l){var ac="",aa=l.replace(/\r\n/g,"\n"),ab=function(ae){return aa.charCodeAt(ae)},Z=function(ae){return String.fromCharCode(ae)};for(var Y=0;Y<aa.length;Y++){var ad=ab(Y);if(ad<128){ac+=Z(ad)}else{if((ad>127)&&(ad<2048)){ac+=(Z((ad>>6)|192)+Z((ad&63)|128))}else{ac+=Z((ad>>12)|224)+Z(((ad>>6)&63)|128)+Z((ad&63)|128)}}}return ac};$.str.decodeUtf8=function(ad){var ae="",ab=0,ac=0,aa=0,Z=0,af=ad,l=function(ag){return af.charCodeAt(ag)},Y=function(ag){return String.fromCharCode(ag)};while(ab<af.length){ac=l(ab);if(ac<128){ae+=Y(ac);ab++}else{if((ac>191)&&(ac<224)){aa=l(ab+1);ae+=Y(((ac&31)<<6)|(aa&63));ab+=2}else{aa=l(ab+1);Z=l(ab+2);ae+=Y(((ac&15)<<12)|((aa&63)<<6)|(Z&63));ab+=3}}}return ae};$.uid=function(){var Y=Math.random().toString().replace(/\b\.\b/,""),l=Math.random().toString().replace(/\b\.\b/,"");return $.str.encodeBase64($.str.format("{0}x{1}",Y,l)).replace(/=+/g,"0").substr(3,32)};function e(l,Y,Z){e.base.call(this);this._local=l;this._domain=Y;this._topLevelDomain=Z}e.prototype={local:function(){return this._local},domain:function(){return this._domain},topLevelDomain:function(){return this._topLevelDomain},equals:function(l){if(!$.exists(l)){return false}return l.local()==this._local&&l.domain().toUpperCase()==this._domain.toUpperCase()&&l.topLevelDomain().toUpperCase()==this._topLevelDomain.toUpperCase()},toString:function(){return $.str.format("{0}@{1}.{2}",this._local,this._domain,this._topLevelDomain)}};$.Class.extend(e,$.Class);$.emailAddress=function(l,Y,Z){return new e(l,Y,Z)};$.emailAddress.Class=e;$.emailAddress.parse=function(ad){if(!($.exists(ad))&&/@{1}/.test(ad)){return null}var aa=ad.split("@"),l=aa[1],Z=l.split("."),Y=aa[0],ac=Z.splice(Z.length-1,1),ab=Z.join(".");return new e(Y,ab,ac)};function g(l){g.base.call(this);this._value=l}g.prototype={value:function(){return this._value},equals:function(l){if(!$.exists(l)){return false}return l.value()==this._value},toStringWithFormat:function(Y){var l=Y;$.list((this._value.toString().split(""))).each(function(Z){l=l.replace("#",Z)});return l.replace(/#/g,"")}};$.Class.extend(g,$.Class);$.phoneNumber=function(l){return new g(l)};$.phoneNumber.Class=g;$.phoneNumber.parse=function(l){return new g(parseInt(l.replace(/[^0-9]/gi,"")))};function P(Z,l,Y){P.base.call(this);this._first=Z;this._middle=l||"";this._last=Y}P.prototype={first:function(){return this._first},middle:function(){return this._middle},last:function(){return this._last},full:function(){var l=($.isNullOrEmpty(this._middle))?"{F} {L}":"{F} {M} {L}";return this.toStringWithFormat(l)},initials:function(){var l=($.isNullOrEmpty(this._middle))?"{f}.{l}.":"{f}.{m}.{l}.";return this.toStringWithFormat(l)},equals:function(l){if(!$.exists(l)){return false}return l.first()==this._first&&l.middle()==this._middle&&l.last()==this._last},toStringWithFormat:function(Z){var l=this._first.charAt(0),Y=this._middle.charAt(0),aa=this._last.charAt(0);return Z.replace("{F}",this._first).replace("{M}",this._middle).replace("{L}",this._last).replace("{f}",l).replace("{m}",Y).replace("{l}",aa)}};$.Class.extend(P,$.Class);$.properName=function(Z,l,Y){return new P(Z,l,Y)};$.properName.Class=P;function N(l){N.base.call(this);this.$h={};this._count=0;var Y=($.exists(l)&&$.exists(l.toObject))?l.toObject():l;for(var Z in Y){this.add(Z,Y[Z])}}N.prototype={count:function(){return this.get("count")},keys:function(){return $.obj.keys(this.$h)},values:function(){return $.obj.values(this.$h)},add:function(Y,l){if((!($.isString(Y)||$.isNumber(Y)))||/(^null$)|(^undefined$)/.test(Y)||this.containsKey(Y)){throw $.ku4exception("$.hash",$.str.format("Invalid key: {0}. Must be unique number or string.",Y))}if($.isUndefined(l)){return}this.$h[Y]=l;this._count++;return this},clear:function(){var l=this.$h;for(n in l){delete l[n]}this._count=0;return this},find:function(l){if(!$.exists(l)){return null}return this.$h[l]},findKey:function(l){var Y=this.$h;for(n in Y){if($.areEqual(Y[n],l)){return n}}return null},findValue:function(l){return this.find(l)},quit:function(){this._iterator.quit();return this},each:function(Y,l){var Z=l||this;this._iterator=$.iterator(this.toObject());this._iterator.each(Y,Z);return this},isEmpty:function(){return this._count<1},contains:function(l){if(!$.exists(l)||$.isNullOrEmpty(l)||$.hash(l).isEmpty()){return false}var Z=$.exists(l.toObject)?l:$.hash(l),Y=true;Z.each(function(ab){if(!$.exists(ab)){Y=false;Z.quit()}else{var aa=ab.key;Y=this.containsKey(aa)&&$.areEqual(this.findValue(aa),ab.value);if(!Y){Z.quit()}}},this);return Y},containsKey:function(l){if(!$.exists(l)){return false}return !$.isUndefined(this.$h[l])},containsValue:function(Y){var l=$.obj.values(this.$h),Z=l.length;while(Z--){if($.areEqual(l[Z],Y)){return true}}return false},merge:function(l){return M(this,l,"merge")},meld:function(l){return M(this,l,"meld")},filter:function(){var l=[this.$h].concat(Array.prototype.slice.call(arguments));return $.hash($.obj.filter.apply($.obj,l))},remove:function(l){if(!this.containsKey(l)){return this}var Y=this.$h;Y[l]="value";delete Y[l];this._count--;return this},replicate:function(){return $.hash($.replicate(this.$h))},toObject:function(){return this.$h},update:function(Y,l){if(!$.exists(Y)){return this}if(!this.containsKey(Y)){this._count++}this.$h[Y]=l;return this}};$.Class.extend(N,$.Class);function M(Z,Y,l){var aa=(!Y.toObject)?Y:Y.toObject();Z.$h=$.obj[l](aa,Z.$h);Z._count=$.obj.count(Z.$h);return Z}$.hash=function(l){return new N(l)};$.hash.Class=N;function x(Z){x.base.call(this);this._keys=[];this._hash=$.hash();this._count=this._keys.length;if(!$.exists(Z)){return}var ab=0,Y=Z.length;while(ab<Y){var aa=Z[ab];if(!$.isUndefined(aa)){this.add(aa)}ab++}}x.prototype={count:function(){return this.get("count")},add:function(Y){var l=this._keys,Z=$.uid();l[l.length]=Z;this._hash.add(Z,Y);this._count=this._keys.length;return this},clear:function(){this._hash.clear();this._keys=[];this._count=this._keys.length;return this},contains:function(l){return this._hash.containsValue(l)},find:function(Y){var l=this._keys;return($.exists(l[Y]))?this._hash.find(l[Y]):null},quit:function(){this._iterator.quit();return this},each:function(Y,l){var Z=l||this;this._iterator=$.iterator(this.toArray());this._iterator.each(Y,Z);return this},isEmpty:function(){return this._count<1},remove:function(Z){var Y=this._hash;if(!this.contains(Z)){return this}var l=Y.findKey(Z);this._keys.splice(l,1);Y.remove(l);this._count=Y.count();return this},toArray:function(){var l=[];this._hash.each(function(Y){l.push(Y.value)});return l}};$.Class.extend(x,$.Class);$.list=function(l){return new x(l)};$.list.Class=x;$.list.parseArguments=function(l){return new x(Array.prototype.slice.call(l))};function R(ac,aa,l,ad,Z,ae,Y){R.base.call(this);if((aa<1)||(aa>12)){throw $.ku4exception("$.dayPoint",$.str.format("Invalid month= {0}",aa))}if((l<1)||(l>W(aa,ac))){throw $.ku4exception("$.dayPoint",$.str.format("Invalid date= {0}",l))}this._value=(arguments.length>=3)?new Date(ac,aa-1,l,ad||0,Z||0,ae||0,Y||0):new Date();var af=this._value;function ag(ah){return ah<10?"0"+ah:""+ah}this._day=af.getDay();this._date=l;this._month=aa;this._year=ac;this._hour=ag(af.getHours());this._minute=ag(af.getMinutes());this._second=ag(af.getSeconds());this._millisecond=ag(af.getMilliseconds());var ab=this._day;this._isWeekday=ab>0&&ab<6;this._isWeekend=!this._isWeekday}R.prototype={value:function(){return this._value},day:function(){return this._day},date:function(){return this._date},month:function(){return this._month},year:function(){return this._year},shortYear:function(){var l=this._year.toString();return parseInt(l.substr(l.length-2))},hour:function(){return this._hour},minute:function(){return this._minute},second:function(){return this._second},millisecond:function(){return this._millisecond},isWeekday:function(){return this._isWeekday},isWeekend:function(){return this._isWeekend},nextDay:function(){return X(this,1,0,0)},prevDay:function(){return X(this,-1,0,0)},nextMonth:function(){return X(this,0,1,0)},prevMonth:function(){return X(this,0,-1,0)},nextYear:function(){return X(this,0,0,1)},prevYear:function(){return X(this,0,0,-1)},add:function(ac,l,ag){function af(ai,am,al){var aj=ai,ak=am;while(ak--){aj=aj[al]()}return aj}var ah=Math.abs,ae=ah(ac),ad=ah(ag),Z=ah(l),Y=ac<0?"prevYear":"nextYear",ab=ag<0?"prevDay":"nextDay",aa=l<0?"prevMonth":"nextMonth";return af(af(af(this,ae,Y),Z,aa),ad,ab)},firstDayOfMonth:function(){return new R(this._year,this._month,1)},lastDayOfMonth:function(){return new R(this._year,this._month,W(this._month,this._year))},isBefore:function(l){return !(this.isAfter(l)||this.equals(l))},isAfter:function(Y){var l=this._year,aa=Y.year(),Z=this._month,ab=Y.month();if(l>aa){return true}if((l==aa)&&(Z>ab)){return true}return((l==aa)&&(Z==ab)&&(this._date>Y.date()))},equals:function(l){return(this._year==l.year())&&(this._month==l.month())&&(this._date==l.date())},toString:function(){return this.toStringWithFormat("mm/dd/yyyy")},toStringWithFormat:function(aa){var ad=(/y{3,}/i.test(aa))?this._year:this.shortYear(),l=this._month,ac=this._date,Z="{0}",Y=(/m{2}/i.test(aa)&&l<10)?"0{1}":"{1}",ab=(/d{2}/i.test(aa)&&ac<10)?"0{2}":"{2}";f=aa.replace(/y{1,}/gi,Z).replace(/m{1,}/gi,Y).replace(/d{1,}/gi,ab);return $.str.format(f,ad,l,ac)},toDate:function(){return this.value()},toJson:function(){return this.value().toJSON()}};$.Class.extend(R,$.Class);$.dayPoint=function(ab,ac,Z,l,aa,ad,Y){if(!($.isDate(ab)||($.isNumber(ab)&&$.isNumber(ac)&&$.isNumber(Z)))){return null}return new R(ab,ac,Z,l,aa,ad,Y)};$.dayPoint.Class=R;$.dayPoint.canParse=function(l){return($.isString(l)||$.isNumber(l)||$.isDate(l))?!isNaN(new Date(l).valueOf()):false};$.dayPoint.parse=function(ae){if(ae instanceof R){return ae}if(!($.isDate(ae)||this.canParse(ae))){return null}var l=new Date(ae),ad=l.getFullYear(),Z=l.getMonth()+1,ac=l.getDate(),aa=l.getHours(),ab=l.getMinutes(),af=l.getSeconds(),Y=l.getMilliseconds();return $.dayPoint(ad,Z,ac,aa,ab,af,Y)};$.dayPoint.tryParse=function(l){return $.dayPoint.canParse(l)?$.dayPoint.parse(l):null};var L;$.dayPoint.assumeNow=function(l){L=$.dayPoint.parse(l)};$.dayPoint.today=function(){return L||$.dayPoint.parse(new Date())};function W(Z,Y){var l=Z,aa=Y;if(l==2){return(v(aa))?29:28}return(((l<8)&&($.isEven(l)))||((l>7)&&($.isOdd(l))))?30:31}function v(l){var Z=l.toString().split(/\B/),Y=parseFloat($.str.build(Z[Z.length-2],Z[Z.length-1]));return(Y%4==0)}function X(ad,ai,Z,ak){var am=ad.month(),ae=ad.year(),ab=ad.date(),l=W(am,ae),al=ai,ac=Z,ah=ak,Y=ab+al,ag=am+ac,aj=ae+ah;if((ab+al)>l){Y=1;ag=(am+(ac+1))}if((ab+al)<1){var aa=ad.prevMonth(),Y=W(aa.month(),aa.year());(ag=am+(ac-1))}if((ag)>12){ag=1;aj=(ae+(ah+1))}if((ag)<1){ag=12;aj=(ae+(ah-1))}var af=W(ag,aj);Y=(Y>af)?af:Y;return new R(aj,ag,Y)}function J(Z,Y){if(!$.exists(Z)||isNaN(Z)){throw $.ku4exception("$.money",$.str.format("Invalid amount= {0}. Amount must be a number.",Z))}J.base.call(this);var l=$.math.roundDown(Z);this._cents=Z-l;this._dollars=l;this._type=Y||"$";this._value=Z}J.prototype={cents:function(){return this._cents},dollars:function(){return this._dollars},type:function(){return this._type},value:function(){return this._value},add:function(l){T(this,l);return new J(this._value+l.value(),this._type)},divide:function(l){if(!$.isNumber(l)){throw $.ku4exception("$.money",$.str.format("Invalid divisor value= {0}",l))}return new J(this._value/l,this._type)},equals:function(l){return(this.isOfType(l))&&(this._value==l.value())},isOfType:function(l){return this._type==l.type()},isGreaterThan:function(l){T(this,l);return this._value>l.value()},isLessThan:function(l){T(this,l);return this._value<l.value()},multiply:function(l){if(!$.isNumber(l)){throw $.ku4exception("$.money",$.str.format("Invalid multiplier value= {0}",l))}return new J(this._value*l,this._type)},round:function(){return new J($.math.round(this.value(),-2),this._type)},roundDown:function(){return new J($.math.roundDown(this.value(),-2),this._type)},roundUp:function(){return new J($.math.roundUp(this.value(),-2),this._type)},subtract:function(l){T(this,l);return new J(this._value-l.value(),this._type)},toString:function(l,aa){var Z=(this.value<0)?"({0}{1}{2}{3})":"{0}{1}{2}{3}",Y=aa||".";return $.str.format(Z,this._type,s(this,l),Y,F(this))}};$.Class.extend(J,$.Class);$.money=function(Y,l){return new J(Y,l)};$.money.Class=J;$.money.zero=function(l){return $.money(0,l)};$.money.isMoney=function(l){return l instanceof J};$.money.canParse=function(l){try{$.money.parse(l);return true}catch(Y){return false}};$.money.parse=function(ac){if($.isNumber(ac)){return $.money(ac)}var l=/(\(.*\))|(\-)/.test(ac),ab=(l)?1:0,aa=ac.match(/[^\d\.\,\-]/g)||[],Z=$.exists(aa[ab])?aa[ab]:"$",ad=parseFloat(ac.replace(/[^\d\.]/g,"")),Y=(l)?-ad:ad;return $.money(Y,Z)};$.money.tryParse=function(l){return $.money.canParse(l)?$.money.parse(l):null};function T(Y,l){if(!Y.isOfType(l)){throw $.ku4exception("$.money",$.str.format("Invalid operation on non-conforming currencies. type: {0} != type: {1}",Y._type,l._type))}}function s(Y,ad){var Z=Y.dollars(),ab=(Y.cents()>=0.995)?(Z+1):Z,ah=ab.toString(),ae=ah.replace(/\-/,"").split(/\B/).reverse(),aa=ae.length,af=aa>3,ac=0,ag=[];while(ac<aa){ag[ag.length]=ae[ac];ac++;if(!$.exists(ae[ac])){break}if((ac%3==0)&&af){ag[ag.length]=ad||","}}return $.str.build.apply(this,ag.reverse())}function F(aa){var ab=$.math.round(aa.cents(),-3),Z=ab.toString(),ac=Z.replace(/\-|(0\.)/g,"").concat("0").split(/\B/),Y=ac.length;if($.isZero(Y)||ab>=0.995){return"00"}if(Y<2){return"0"+ac[0]}return(parseInt(ac[2])>4)?ac[0]+(parseInt(ac[1])+1):ac[0]+ac[1]}function u(l,Y){if(!$.isNumber(l)||!$.isNumber(Y)){throw $.ku4exception("$.coord",$.str.format("Invalid arguments x= {0}, y= {1} ",l,Y))}u.base.call(this);this.x(l).y(Y)}u.prototype={x:function(l){return this.property("x",l)},y:function(l){return this.property("y",l)},abs:function(){return new u(Math.abs(this._x),Math.abs(this._y))},add:function(Y){var l=this._x+Y.x(),Z=this._y+Y.y();return new u(l,Z)},divide:function(Y){var l=this._x/Y.x(),Z=this._y/Y.y();return new u(l,Z)},equals:function(l){return(this._x===l.x())&&(this._y===l.y())},multiply:function(Y){var l=this._x*Y.x(),Z=this._y*Y.y();return new u(l,Z)},subtract:function(Y){var l=this._x-Y.x(),Z=this._y-Y.y();return new u(l,Z)},round:function(l){var Y=l||0;return new u($.math.round(this.x(),Y),$.math.round(this.y(),Y))},half:function(){return this.divide(new u(2,2))},value:function(){return{x:this._x,y:this._y}},toEm:function(){return E(this,"em")},toPixel:function(){return E(this,"px")},toString:function(){return $.str.format("({0},{1})",this._x,this._y)}};$.Class.extend(u,$.Class);$.coord=function(l,Y){return new u(l,Y)};$.coord.Class=u;function E(Y,l){return{x:function(){return Y.x()+l},y:function(){return Y.y()+l}}}function H(l){try{if(("left" in l)&&("top" in l)){return !isNaN(l.left)&&!isNaN(l.top)}if(("width" in l)&&("height" in l)){return !isNaN(l.width)&&!isNaN(l.height)}return false}catch(Y){return false}}function j(l){if(!$.exists(l)){return null}if($.exists(l.left)&&$.exists(l.top)){return new u(l.left,l.top)}if($.exists(l.width)&&$.exists(l.height)){return new u(l.width,l.height)}return null}$.coord.zero=function(){return new u(0,0)};$.coord.random=function(Z,Y){var l=Z*Math.random(),aa=Y*Math.random(Y);return new u(l,aa)};$.coord.canParse=j;$.coord.parse=j;$.coord.tryParse=function(l){return H(l)?j(l):null};function D(l,Y){D.base.call(this,l,Y)}D.prototype={isAbove:function(l){return this.y()<l.y()},isBelow:function(l){return this.y()>l.y()},isLeftOf:function(l){return this.x()<l.x()},isRightOf:function(l){return this.x()>l.x()},distanceFrom:function(l){return $.vector(this.x()-l.x(),this.y()-l.y())},distanceTo:function(l){return this.distanceFrom(l).invert()}};$.Class.extend(D,$.coord.Class);$.point=function(l,Y){return new D(l,Y)};$.point.Class=D;$.point.zero=function(){return new D(0,0)};$.point.canParse=A;$.point.parse=a;$.point.tryParse=function(l){return A(l)?a(l):null};function A(l){try{return !isNaN(l.x())&&!isNaN(l.y())}catch(Y){return false}}function a(l){return new D(l.x(),l.y())}function V(l,Y){V.base.call(this);this._topLeft=$.point.parse(l);this._dims=$.point.parse(Y);this._bottomRight=$.point.parse(l.add(Y))}V.prototype={dims:function(){return this.get("dims")},topLeft:function(){return this.get("topLeft")},bottomRight:function(){return this.get("bottomRight")},center:function(){return this._topLeft.add(this._bottomRight.subtract(this._topLeft)).half()},contains:function(Z){var Y=this._topLeft,l=this._bottomRight;return Y.isAbove(Z)&&Y.isLeftOf(Z)&&l.isRightOf(Z)&&l.isBelow(Z)}};$.Class.extend(V,$.Class);$.rectangle=function(Y,l){return new V(Y,l)};$.rectangle.Class=V;function b(l,Y){if(!$.isNumber(l)||!$.isNumber(Y)){throw $.ku4exception("$.vector",$.str.format("Invalid arguments x= {0}, y= {1} ",l,Y))}b.base.call(this,l,Y);this._lengthSquared=c(this,l,Y);this._length=t(this,this._lengthSquared);this._unitNormalX=G(this,l);this._unitNormalY=G(this,Y)}b.prototype={magnitude:function(){return this.get("length")},equals:function(l){return(l instanceof b)&&((this._x===l.x())&&(this._y===l.y()))},normal:function(){return $.vector(this._unitNormalX,this._unitNormalY)},invert:function(){return $.vector(this.x()*-1,this.y()*-1)},norm:function(){return $.vector(Math.abs(this.x()),Math.abs(this.y()))},perpendicular:function(){return $.vector(this.y()*-1,this.x())},isZero:function(){return this.x()==0&&this.y()==0},add:function(l){return $.vector(this.x()+l.x(),this.y()+l.y())},dot:function(l){return(this.x()*l.x())+(this.y()*l.y())},perpendicularAtTo:function(l){var Y=l.add(this.projectionOfOnto(l).invert());return $.vector(Y.x(),Y.y())},projectionOfOnto:function(l){var Y=l.normal().scale(this.dot(l.normal()));return $.vector(Y.x(),Y.y())},scale:function(l){return $.vector((this.x()*l),(this.y()*l))},unitNormalDot:function(l){return(this.normal().x()*l.normal().x())+(this.normal().y()*l.normal().y())},reflect:function(l){if(l.isZero()){return this}var Y=l.normal();return this.add(Y.scale(2*(Y.dot(this))).invert())},round:function(l){var Y=l||0;return $.vector($.math.round(this.x(),Y),$.math.round(this.y(),Y))}};$.Class.extend(b,$.coord.Class);$.vector=function(l,Y){return new b(l,Y)};$.vector.Class=b;$.vector.zero=function(){return $.vector(0,0)};$.vector.random=function(Z,Y){var l=Z*Math.random(),aa=Y*Math.random();return $.vector(l,aa)};function t(l,Y){if(l.isZero()){return 0}return Math.sqrt(Y)}function c(Y,l,Z){if(Y.isZero()){return 0}return Math.pow(l,2)+Math.pow(Z,2)}function G(Y,l){if(Y.isZero()){return 0}return l/Y.magnitude()}$.abstractContext=function(l){$.abstractContext.base.call(this);this.state(l)};$.abstractContext.prototype={state:function(l){if(!$.exists(l)){return this._state}return this.set("state",l.context(this))}};$.Class.extend($.abstractContext,$.Class);$.abstractState=function(l){$.abstractState.base.call(this);this.states(l)};$.abstractState.prototype={context:function(l){return this.property("context",l)},states:function(l){return this.set("states",l)},state:function(l){var Y=this._context;Y.state(new this._states[l](Y));return this}};$.Class.extend($.abstractState,$.Class);$.abstractVisitor=function(){};$.abstractVisitor.prototype={$visit:function(){throw new Error("visit method is abstract an must be defined.")},subject:function(l){return this.property("subject",$.replicate(l))},visit:function(){return this.$visit()}};function w(l){w.base.call(this);this.$current=0;this._quit=false;this.subject(l)}w.prototype={$hasNext:function(){return $.exists(this._subject[this.$current+1])},$hasPrev:function(){return $.exists(this._subject[this.$current-1])},$each:function(Y,Z){var l=Z||this;this.reset();do{Y.call(l,this.current())}while(this.next()&&(!this._quit));this._end=false;this.reset()},$exec:function(Z){var l=this._subject,Y=l[Z];if(!$.exists(Y)){return null}this.$current=Z;return Y},subject:function(Y){var l=($.isArray(Y))?Y:($.isObject(Y))?k(Y):Y;if(!$.isUndefined(Y)){this.reset()}this.$subject=l;return this.property("subject",l)},current:function(){return this.$exec(this.$current)},next:function(){return this.$exec(this.$current+1)},prev:function(){return this.$exec(this.$current-1)},hasNext:function(){return this.$hasNext()},hasPrev:function(){return this.$hasPrev()},reset:function(){this.$current=0;return this},quit:function(){return this.set("quit",true)},each:function(l,Y){if(this._subject.length<1){return this}this.$each(l,Y);return this}};function k(l){var Y=[];for(n in l){Y.push({key:n,value:l[n]})}return Y}$.Class.extend(w,$.Class);$.iterator=function(l){return new w(l)};$.iterator.Class=w;function B(){B.base.call(this);this._observers=$.hash();this._throwErrors=0}B.prototype={throwErrors:function(){this._throwErrors=2;return this},logErrors:function(){this._throwErrors=1;return this},catchErrors:function(){this._throwErrors=0;return this},isEmpty:function(){return this._observers.isEmpty()},count:function(){return this._observers.count()},activeSubscriptionKeys:function(){return this._observers.keys()},subscribe:function(l,ab,Y,aa){var Z=this._observers;if(Z.containsKey(l)){Z.find(l).add(ab,Y,aa)}else{Z.add(l,$.observer().add(ab,Y,aa))}return this},unsubscribe:function(l,Z){var Y=this._observers;if(Y.containsKey(l)){Y.find(l).remove(Z)}return this},notify:function(){var l=$.list.parseArguments(arguments),Y=$.list(),Z=$.list();l.each(function(aa){if(this._observers.containsKey(aa)){Z.add(aa)}else{Y.add(aa)}},this);return(Z.isEmpty())?this._notifyAll(Y.toArray()):this._notify(Y.toArray(),Z)},clear:function(){this._observers.each(function(l){l.value.clear()}).clear();return this},_notifyAll:function(l){$.list(this._observers.values()).each(function(Y){Y.notify.apply(Y,l)});return this},_notify:function(Z,Y){var aa=this._observers,l=this._throwErrors;Y.each(function(ac){try{var ab=aa.find(ac);ab.notify.apply(ab,Z)}catch(ae){var ad=$.ku4exception("$.mediator",$.str.format("{0}. Subscriber key= {1}",ae.message,ac));if(l==2){throw ad}if(l==1){$.ku4Log(ad.message)}}});return this}};$.Class.extend(B,$.Class);$.mediator=function(){return new B()};$.mediator.Class=B;function C(){C.base.call(this);this._methods=new $.hash()}C.prototype={add:function(ab,Y,aa){var l=aa||$.uid("observerMethod"),Z=Y||this;this._methods.add(l,{m:ab,s:Z});return this},remove:function(l){this._methods.remove(l);return this},clear:function(){this._methods.clear();return this},notify:function(){var Y=new $.iterator(this._methods.values()),l=arguments;Y.each(function(Z){if(!$.exists(Z.m)){throw $.ku4exception("$.observer",$.str.format("Invalid or null method"))}Z.m.apply(Z.s,l)});return this},isEmpty:function(){return this._methods.isEmpty()}};$.Class.extend(C,$.Class);$.observer=function(){return new C()};$.observer.Class=C;function m(){this._q=[]}m.prototype={isEmpty:function(){return this._q.length==0},enqueue:function(l){var Y=this._q;Y[Y.length]=l;return this},dequeue:function(){var Y=this._q,l=Y[0];Y.splice(0,1);return l},clear:function(){this._q=[]}};$.fifo=function(){return new m()};$.fifo.Class=m;function K(l){K.base.call(this,l)}K.prototype={$hasNext:function(){var aa=this.$subject,Y=aa.length-1,ac=this.$current,ab=ac+1,Z=(ab>Y)?0:ab;return $.exists(aa[Z])},$hasPrev:function(){var aa=this.$subject,Y=aa.length-1,ac=this.$current,ab=ac+1,Z=(ab<0)?Y:ab;return $.exists(aa[Z])},$each:function(Y,Z){var l=Z||this;this.reset();do{Y.call(Z,this.current())}while(this.next()&&(this.$current>0));this.reset()},$exec:function(aa){var Z=this.$subject,Y=(Z.length-1);this.$current=(aa>Y)?0:((aa<0)?Y:aa);return Z[this.$current]}};$.Class.extend(K,$.iterator.Class);$.rolodex=function(l){return new K(l)};$.rolodex.Class=K;function U(){}U.prototype={$isSatisfiedBy:function(l){return},isSatisfiedBy:function(l){return this.$isSatisfiedBy(l)},and:function(l){return new I(this,l)},or:function(l){return new o(this,l)},xor:function(l){return new z(this,l)},not:function(){return new Q(this)}};function I(Y,l){I.base.call(this);this.$1=Y;this.$2=l}I.prototype.$isSatisfiedBy=function(l){return this.$1.isSatisfiedBy(l)&&this.$2.isSatisfiedBy(l)};$.Class.extend(I,U);function o(Y,l){o.base.call(this);this.$1=Y;this.$2=l}o.prototype.$isSatisfiedBy=function(l){return this.$1.isSatisfiedBy(l)||this.$2.isSatisfiedBy(l)};$.Class.extend(o,U);function z(Y,l){z.base.call(this);this.$1=Y;this.$2=l}z.prototype.$isSatisfiedBy=function(l){return $.xor(this.$1.isSatisfiedBy(l),this.$2.isSatisfiedBy(l))};$.Class.extend(z,U);function p(){p.base.call(this)}p.prototype.$isSatisfiedBy=function(l){return true};$.Class.extend(p,U);function h(){h.base.call(this)}h.prototype.$isSatisfiedBy=function(l){return false};$.Class.extend(h,U);function Q(l){Q.base.call(this);this._s=l}Q.prototype.$isSatisfiedBy=function(l){return !this._s.isSatisfiedBy(l)};$.Class.extend(Q,U);function r(l){r.base.call(this);this.$isSatisfiedBy=l}$.Class.extend(r,U);$.spec=function(l){return new r(l)};function y(){this._q=[]}y.prototype={isEmpty:function(){return this._q.length==0},push:function(l){var Y=this._q;Y[Y.length]=l;return this},pop:function(){return this._q.pop()},clear:function(){this._q=[]}};$.lifo=function(){return new y()};$.lifo.Class=y})(jQuery);